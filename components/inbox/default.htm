<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

{% if flashMessage %}
<div class="alert alert-success">{{ flashMessage }}</div>
{% endif %}

<section is="inbox" class="mt-2" show-reply-fields="{{ true }}">
    <h3>Inbox</h3>
    {% if messages %}
    {% for message in messages %}
    <div class="accordion accordion-flush" id="accordionInbox{{ message.id }}">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapse{{ message.id }}" aria-expanded="true" aria-controls="collapseOne">
                    <h4><strong><i class="bi bi-calendar2-event"></i> {{ message.created_at }}</strong>: Message From {{
                        message.sender_name }}</h4>
                </button>
            </h2>
            <div id="collapse{{ message.id }}" class="accordion-collapse collapse"
                data-bs-parent="#accordionInbox{{ message.id }}">
                <div class="accordion-body border">
                    <strong><i class="bi bi-card-text"></i> Message:</strong>
                    <div><i>{{ message.content|raw }}</i></div>
                    {% if showReplyFields %}
                    <form method="post" data-request="{{ onReplyMessage }}">
                        <input type="hidden" name="messageId" value="{{ message.id }}">
                        <div class="input-group">
                            <textarea class="form-control" name="messageContent" rows="2"
                                placeholder="Reply to this message">{{ replyContent }}</textarea>
                            <button type="submit" class="btn btn-primary">Send reply</button>
                        </div>
                    </form>
                    {% endif %}
                    <button type="button" class="btn btn-outline-danger" data-request="onDeleteMessage"
                        data-request-data="messageId: {{ message.id }}"
                        data-request-confirm="Are you sure you want to delete this message?"><i
                            class="bi bi-trash3"></i> Delete
                        message
                    </button>
                    {% if not message.is_read %}
                    <button type="submit" data-request="onReadMessage" data-request-data="messageId: {{ message.id }}"
                        type="button" class="btn btn-outline-success"><i class="bi bi-envelope-check"></i> Mark as read
                    </button>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <p>No messages found.</p>
    {% endif %}
</section>